<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>&quot;api/verification/VerificationRequestCollection.methods&quot; | radgrad2</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../assets/js/search.js" data-base="..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../index.html" class="title">radgrad2</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../globals.html">Globals</a>
				</li>
				<li>
					<a href="_api_verification_verificationrequestcollection_methods_.html">&quot;api/verification/VerificationRequestCollection.methods&quot;</a>
				</li>
			</ul>
			<h1>External module &quot;api/verification/VerificationRequestCollection.methods&quot;</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<section class="tsd-panel-group tsd-index-group">
				<h2>Index</h2>
				<section class="tsd-panel tsd-index-panel">
					<div class="tsd-index-content">
						<section class="tsd-index-section ">
							<h3>Variables</h3>
							<ul class="tsd-index-list">
								<li class="tsd-kind-variable tsd-parent-kind-external-module"><a href="_api_verification_verificationrequestcollection_methods_.html#processpendingverificationmethod" class="tsd-kind-icon">process<wbr>Pending<wbr>Verification<wbr>Method</a></li>
								<li class="tsd-kind-variable tsd-parent-kind-external-module"><a href="_api_verification_verificationrequestcollection_methods_.html#processverificationeventmethod" class="tsd-kind-icon">process<wbr>Verification<wbr>Event<wbr>Method</a></li>
								<li class="tsd-kind-variable tsd-parent-kind-external-module"><a href="_api_verification_verificationrequestcollection_methods_.html#verificationrequestsupdatestatusmethod" class="tsd-kind-icon">verification<wbr>Requests<wbr>Update<wbr>Status<wbr>Method</a></li>
							</ul>
						</section>
						<section class="tsd-index-section tsd-is-not-exported">
							<h3>Functions</h3>
							<ul class="tsd-index-list">
								<li class="tsd-kind-function tsd-parent-kind-external-module tsd-is-not-exported"><a href="_api_verification_verificationrequestcollection_methods_.html#getopportunityinstanceid" class="tsd-kind-icon">get<wbr>Opportunity<wbr>InstanceID</a></li>
							</ul>
						</section>
					</div>
				</section>
			</section>
			<section class="tsd-panel-group tsd-member-group ">
				<h2>Variables</h2>
				<section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-external-module">
					<a name="processpendingverificationmethod" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagConst">Const</span> process<wbr>Pending<wbr>Verification<wbr>Method</h3>
					<div class="tsd-signature tsd-kind-icon">process<wbr>Pending<wbr>Verification<wbr>Method<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">ValidatedMethod</span><span class="tsd-signature-symbol"> =&nbsp;new ValidatedMethod({name: &#x27;VerificationRequests.processPendingVerification&#x27;,validate: null,mixins: [CallPromiseMixin],run({ verificationRequestID, command, feedback }) {// Verify that currently logged in user is an admin, advisor, or faculty. otherwise no verification can occur.VerificationRequests.assertRole(Meteor.userId(), [ROLE.ADMIN, ROLE.ADVISOR, ROLE.FACULTY]);// Verify that the ID is valid.const requestDoc &#x3D; VerificationRequests.findDoc(verificationRequestID);// Verify that the command is VerificationRequests.ACCEPTED or REJECTED.if ((command !&#x3D;&#x3D; VerificationRequests.ACCEPTED) &amp;&amp; (command !&#x3D;&#x3D; VerificationRequests.REJECTED)) {throw new Meteor.Error(&#x60;VerificationRequest command is invalid: ${command}&#x60;);}// Update the opportunityInstance corresponding to this verification request.const verified &#x3D; (command &#x3D;&#x3D;&#x3D; VerificationRequests.ACCEPTED);OpportunityInstances.update(requestDoc.opportunityInstanceID, { verified });// Update the verification request.VerificationRequests.setVerificationStatus(verificationRequestID, Meteor.userId(), command, feedback);// Create a feed entry only if it was verifiedconst student &#x3D; Users.getProfile(requestDoc.studentID).username;if (verified) {const opportunityInstanceID &#x3D; requestDoc.opportunityInstanceID;const opportunity &#x3D; OpportunityInstances.getOpportunityDoc(opportunityInstanceID)._id;const academicTermDoc &#x3D; OpportunityInstances.getAcademicTermDoc(opportunityInstanceID);const academicTerm &#x3D; &#x60;${academicTermDoc.term}-${academicTermDoc.year}&#x60;;Feeds.define({ feedType: Feeds.VERIFIED_OPPORTUNITY, user: student, opportunity, academicTerm });}return &#x60;Verification request for ${student} was processed&#x60;;},})</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in <a href="https://github.com/radgrad/radgrad2/blob/e3e0112/app/imports/api/verification/VerificationRequestCollection.methods.ts#L122">api/verification/VerificationRequestCollection.methods.ts:122</a></li>
						</ul>
					</aside>
					<div class="tsd-comment tsd-typography">
						<div class="lead">
							<p>This Meteor Method processes a command from the Pending Verification Request widget.
								The method is passed a verificationRequestID, a command (ACCEPTED or REJECTED), and an optional feedback string.
								The method returns a string indicating what happened.
							Processing this request involves the following:</p>
						</div>
						<ul>
							<li>Make sure user is a faculty, advisor, or admin. Otherwise throw error.</li>
							<li>If verificationRequestID is not a valid ID, then throw error.</li>
							<li>If command is not VerificationRequests.ACCEPTED or VerificationRequests.REJECTED, then returns an error string.</li>
							<li>Creates a process object to record this command.</li>
							<li>Updates the VerificationRequest with the new process object and the new status.</li>
							<li>Creates a new Feed instance only if the request was accepted.</li>
						</ul>
						<p>Only faculty, advisors, and admins can invoke this method.</p>
						<dl class="tsd-comment-tags">
							<dt>memberof</dt>
							<dd><p>api/verification</p>
							</dd>
						</dl>
					</div>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-external-module">
					<a name="processverificationeventmethod" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagConst">Const</span> process<wbr>Verification<wbr>Event<wbr>Method</h3>
					<div class="tsd-signature tsd-kind-icon">process<wbr>Verification<wbr>Event<wbr>Method<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">ValidatedMethod</span><span class="tsd-signature-symbol"> =&nbsp;new ValidatedMethod({name: &#x27;VerificationRequests.processVerificationEvent&#x27;,validate: null,mixins: [CallPromiseMixin],run({ student, opportunity, academicTerm, verified &#x3D; false }: { student: string; opportunity: string; academicTerm: string; verified?: boolean; }) {// Define a string to hold the result of this process.let resultMessage &#x3D; &#x27;&#x27;;// Verify that currently logged in user is an admin, advisor, or faculty. otherwise no verification can occur.VerificationRequests.assertRole(Meteor.userId(), [ROLE.ADMIN, ROLE.ADVISOR, ROLE.FACULTY]);// Make sure there&#x27;s an opportunity instance for this student.let opportunityInstanceID &#x3D; getOpportunityInstanceID(student, opportunity, academicTerm);if (!opportunityInstanceID) {resultMessage +&#x3D; &#x27;  No opportunity instance found. Defining a new one.\n&#x27;;opportunityInstanceID &#x3D; OpportunityInstances.define({ academicTerm, opportunity, student, verified });}// Make sure there&#x27;s a verification request for this opportunity instance.let verificationRequestID &#x3D; VerificationRequests.findOne({ opportunityInstanceID });if (!verificationRequestID) {resultMessage +&#x3D; &#x27;  No verification request found. Defining a new one.\n&#x27;;verificationRequestID &#x3D; VerificationRequests.define({ student, opportunityInstance: opportunityInstanceID });}// If this event has already been verified, then return now.if (OpportunityInstances.findDoc(opportunityInstanceID).verified) {const opp &#x3D; Opportunities.findDoc(opportunity);return &#x60;  Event ${opp.name} is already verified for ${student}\n&#x60;;}// Otherwise verify the opportunity instance and the VerificationRequestID.resultMessage +&#x3D; &#x27;  Setting the opportunity instance and verification request to verified.\n&#x27;;OpportunityInstances.update(opportunityInstanceID, { verified: true });VerificationRequests.setVerified(verificationRequestID, Meteor.userId());// Create a Feed entry for this verification event.resultMessage +&#x3D; &#x27;  Creating a feed entry.\n&#x27;;Feeds.define({ feedType: Feeds.VERIFIED_OPPORTUNITY, user: student, opportunity, academicTerm });return resultMessage;},})</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in <a href="https://github.com/radgrad/radgrad2/blob/e3e0112/app/imports/api/verification/VerificationRequestCollection.methods.ts#L62">api/verification/VerificationRequestCollection.methods.ts:62</a></li>
						</ul>
					</aside>
					<div class="tsd-comment tsd-typography">
						<div class="lead">
							<p>This Meteor Method processes a request to verify an opportunity for a given user from the VerificationEvent page.
								The method is passed a student, opportunity, and academicTerm, which should normally be valid.
							Processing this request involves the following:</p>
							<ul>
								<li>If the student does not have an Opportunity Instance for this opportunity and academicTerm, then one is created
								for them.</li>
								<li>If the student has not already submitted a Verification Request for their Opportunity Instance, then one is
								created for them.</li>
								<li>If the student has already been verified for this Opportunity, then nothing more is done.</li>
								<li>Once the OpportunityInstance and VerificationRequest exist, then they are updated to indicate that they have
								been verified if they are not already verified.</li>
								<li>A status string is returned to the caller to indicate the result of processing.
								Only faculty, advisors, and admins can invoke this method.</li>
							</ul>
						</div>
						<dl class="tsd-comment-tags">
							<dt>memberof</dt>
							<dd><p>api/verification</p>
							</dd>
						</dl>
					</div>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-external-module">
					<a name="verificationrequestsupdatestatusmethod" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagConst">Const</span> verification<wbr>Requests<wbr>Update<wbr>Status<wbr>Method</h3>
					<div class="tsd-signature tsd-kind-icon">verification<wbr>Requests<wbr>Update<wbr>Status<wbr>Method<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">ValidatedMethod</span><span class="tsd-signature-symbol"> =&nbsp;new ValidatedMethod({name: &#x27;VerificationRequests.updateStatus&#x27;,validate: null,mixins: [CallPromiseMixin],run(update) {// Verify that currently logged in user is an admin, advisor, or faculty. otherwise no update can occur.VerificationRequests.assertRole(Meteor.userId(), [ROLE.ADMIN, ROLE.ADVISOR, ROLE.FACULTY]);return VerificationRequests.updateStatus(update.id, update.status, update.processed);},})</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in <a href="https://github.com/radgrad/radgrad2/blob/e3e0112/app/imports/api/verification/VerificationRequestCollection.methods.ts#L20">api/verification/VerificationRequestCollection.methods.ts:20</a></li>
						</ul>
					</aside>
					<div class="tsd-comment tsd-typography">
						<div class="lead">
							<p>The ValidatedMethod for updating the status of VerificationRequests.
								Passed an object with fields:
								id: the verificationRequestID
								status: boolean
							processed: a project object.</p>
						</div>
						<dl class="tsd-comment-tags">
							<dt>memberof</dt>
							<dd><p>api/verification</p>
							</dd>
						</dl>
					</div>
				</section>
			</section>
			<section class="tsd-panel-group tsd-member-group tsd-is-not-exported">
				<h2>Functions</h2>
				<section class="tsd-panel tsd-member tsd-kind-function tsd-parent-kind-external-module tsd-is-not-exported">
					<a name="getopportunityinstanceid" class="tsd-anchor"></a>
					<h3>get<wbr>Opportunity<wbr>InstanceID</h3>
					<ul class="tsd-signatures tsd-kind-function tsd-parent-kind-external-module tsd-is-not-exported">
						<li class="tsd-signature tsd-kind-icon">get<wbr>Opportunity<wbr>InstanceID<span class="tsd-signature-symbol">(</span>student<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span>, opportunity<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span>, academicTerm<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in <a href="https://github.com/radgrad/radgrad2/blob/e3e0112/app/imports/api/verification/VerificationRequestCollection.methods.ts#L39">api/verification/VerificationRequestCollection.methods.ts:39</a></li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Returns the opportunityInstanceID associated with the student and opportunity, or null if not found.</p>
								</div>
								<dl class="tsd-comment-tags">
									<dt>memberof</dt>
									<dd><p>api/verification</p>
									</dd>
								</dl>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>student: <span class="tsd-signature-type">any</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>The student.</p>
									</div>
								</li>
								<li>
									<h5>opportunity: <span class="tsd-signature-type">any</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>The opportunity.</p>
									</div>
								</li>
								<li>
									<h5>academicTerm: <span class="tsd-signature-type">any</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>The academicTerm</p>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">any</span></h4>
							<p>The opportunityInstanceID, or null if it wasn&#39;t found.</p>
						</li>
					</ul>
				</section>
			</section>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="../globals.html"><em>Globals</em></a>
					</li>
					<li class="current tsd-kind-external-module">
						<a href="_api_verification_verificationrequestcollection_methods_.html">"api/verification/<wbr>Verification<wbr>Request<wbr>Collection.methods"</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-variable tsd-parent-kind-external-module">
						<a href="_api_verification_verificationrequestcollection_methods_.html#processpendingverificationmethod" class="tsd-kind-icon">process<wbr>Pending<wbr>Verification<wbr>Method</a>
					</li>
					<li class=" tsd-kind-variable tsd-parent-kind-external-module">
						<a href="_api_verification_verificationrequestcollection_methods_.html#processverificationeventmethod" class="tsd-kind-icon">process<wbr>Verification<wbr>Event<wbr>Method</a>
					</li>
					<li class=" tsd-kind-variable tsd-parent-kind-external-module">
						<a href="_api_verification_verificationrequestcollection_methods_.html#verificationrequestsupdatestatusmethod" class="tsd-kind-icon">verification<wbr>Requests<wbr>Update<wbr>Status<wbr>Method</a>
					</li>
					<li class=" tsd-kind-function tsd-parent-kind-external-module tsd-is-not-exported">
						<a href="_api_verification_verificationrequestcollection_methods_.html#getopportunityinstanceid" class="tsd-kind-icon">get<wbr>Opportunity<wbr>InstanceID</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../assets/js/search.js"><' + '/script>');</script>
</body>
</html>